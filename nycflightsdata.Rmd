---
title: "NYC Flight Data"
knit: (function(input_file, encoding) {
  out_dir <- 'docs';
  rmarkdown::render(input_file,
 encoding=encoding,
 output_file=file.path(dirname(input_file), out_dir, 'nycflightsdata.html'))})
output: html_document
---

Week 6 in STAT-363 : Introduction to R we worked with the 2013 NYC Flights data. 

```{r setup, include=FALSE}
knitr::opts_chunk$set(echo = TRUE)
library(magrittr)
library(dplyr)
library(nycflights13)
library(pander)
library(tidyr)
library(gt)
library(tidyverse)
library(ggplot2)
library(ggthemes)
library(maps)
library(lubridate)
library(shiny)
```

To begin we used 'dplyr' to figure out how many flights to Los Angeles (LAX) did each of the legacy carriers (AA, UA, DL or US) have in May from JFK, and what was their average duration. 

```{r, echo=F}
flights %>%
  filter(dest == "LAX", 
         month == 5, 
         origin == "JFK", 
         carrier%in%c("AA", "UA", "DL", "US")) %>%
  group_by(carrier) %>%
  summarise(num_flights = n(),
            mean_duration = mean(air_time,na.rm=T)) %>%
  arrange(-desc(mean_duration)) %>% 
  gt() %>%
  tab_header(
    title = md("Mean Duration of Flights from LAX to JFK in May 2013"),
    subtitle = "From American Airlines (AA), United Airlines (UA), Delta Air (DL), and US"
  ) %>%
  cols_label(
    carrier = "Carrier",
    num_flights = "Number of Flights",
    mean_duration = "Mean Duration") %>%
  tab_source_note(
    source_note = "Note: There were no flights made from LAX to NYC in May 2013 from US"
  )
```

Analysis : American Airlines had the most flights with the least amount of mean duration time of the four carriers chosen. 

What was the shortest flight out of each airport in terms of distance? In terms of duration?

```{r, echo=F}
flights %>%
  group_by(origin) %>%
  summarise(min_dist=min(distance,na.rm=T),
            min_air_time=min(air_time,na.rm=T)) %>% 
  gt() %>%
  tab_header(title = md("Shortest Flight")) %>%
  tab_footnote(
    footnote = "Newark Liberty International Airport",
    locations = cells_body(columns = origin, rows = 1)) %>%
  tab_footnote(
    footnote = "John F. Kennedy International Airport",
    locations = cells_body(columns = origin, rows = 2)) %>%
  tab_footnote(
    footnote = "LaGuardian Airport",
    locations = cells_body(columns = origin, rows = 3)) %>%
  cols_label(origin = "Airport",
             min_dist = "By Distance",
             min_air_time = "By Flight Time")
```

Newark Liberty International Airport is has the shortest flight by both time and distance. 

... [to be continued]

In the following week we continued to play with the nyc flights 2013 data and various joins. 

```{r, echo=F}
# Load up datasets from `nycflights13`
data(flights)
data(airports)
data(planes)
```

Compute the average delay by destination, then join on the airports data frame so we can show the spatial distribution of delays. 
```{r, echo=F}
#avg.dest.delay : modified dataset 
#group flights data set by destination 
#summarize takes each level of destination and summarize mean of arr_delay 
#inner join to airports dataset by destination and faa 
#filter removes NA's from delay, lat, and lon 
#mutate : if else statement if delay is less than 0 (aka early) it is 0 
avg.dest.delay <- 
  flights %>% 
  group_by(dest) %>%
  summarise(delay = mean(arr_delay, na.rm = T)) %>%
  inner_join(airports, by = c(dest = "faa")) %>%
  filter(!is.na(delay)&!is.na(lat)&!is.na(lon)) %>%
  mutate(delay=ifelse(delay<0,0,delay))
#modified from DTR's code, added colour and size for delay
#guides() joins size and color into one legend 
avg.dest.delay  %>%
  ggplot(aes(lon, lat, colour = delay, size = delay)) +
    borders("state") +
    geom_point() +
    coord_quickmap() +
  guides(colour = 'legend')
```

West coast best coast. 

<!-- ## Shiny Attempt  -->

<!-- Average arrival delay : PDX, LAX and PHX  -->

<!-- ```{r, message=F, echo=F} -->
<!-- flight.delay <- flights %>%  -->
<!--   select(year,month,day,dest,arr_delay) %>% -->
<!--   mutate(date = make_date(year, month, day)) %>% -->
<!--   filter(dest%in%c("PDX","LAX","PHX")) %>% -->
<!--   group_by(dest,date) %>% -->
<!--   summarise(delay = mean(arr_delay, na.rm = T)) -->

<!-- ui <- fluidPage( -->
<!--   plotOutput("paired_plot") -->
<!-- ) -->
<!-- server <- function(input, output) { -->
<!--   output$paired_plot <- renderPlot({ -->
<!--   ggplot(flight.delay) + -->
<!--   aes_string(x="date", -->
<!--              y="delay", -->
<!--              color="dest") + -->
<!--   geom_point() -->
<!--   }) -->
<!-- } -->
<!-- shinyApp(ui = ui, server = server) -->
<!-- ``` -->

